#!/usr/bin/env bash

# ==============================================================================
# Descrição: Modelo de script robusto seguindo padrões de design
# Autor: Seu Nome
# Versão: 1.0.0
# ==============================================================================

# 1. MODO ESTRITO (Strict Mode)
# -e: sai se um comando falhar
# -u: erro se usar variável não definida
# -o pipefail: erro se falha em qualquer parte de um pipe
set -euo pipefail
IFS=$'\n\t'

# 2. VARIÁVEIS GLOBAIS E CORES
readonly SCRIPT_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd)
readonly LOG_FILE="/tmp/$(basename "$0").log"

# Cores para feedback visual
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# 3. FUNÇÃO DE AJUDA (Usage)
usage() {
	cat <<EOF
Uso: $(basename "$0") [OPÇÕES]

Descrição:
    Script de exemplo que segue padrões profissionais de Bash.

Opções:
    -h, --help      Exibe esta ajuda.
    -f, --file      Caminho para o ficheiro de entrada.
    -v, --verbose   Ativa o modo detalhado.
EOF
	exit 0
}

# 4. LIMPEZA (Cleanup Pattern)
cleanup() {
	trap - SIGINT SIGTERM ERR EXIT
	# Adicione aqui remoção de ficheiros temporários ou fecho de conexões
	echo -e "${YELLOW}\n[!] Realizando limpeza e saindo...${NC}"
}

trap cleanup SIGINT SIGTERM ERR EXIT

# 5. LÓGICA DE NEGÓCIO (Funções menores)
fazer_algo() {
	local ficheiro=$1
	echo -e "${GREEN}[*] Processando: $ficheiro${NC}"
	# Idempotência: verifica se o ficheiro existe antes de agir
	if [[ -f "$ficheiro" ]]; then
		echo "Lógica aqui..."
	else
		echo -e "${RED}[ERRO] Ficheiro não encontrado.${NC}"
		return 1
	fi
}

# 6. PARSING DE ARGUMENTOS
parse_params() {
	input_file=""
	verbose=false

	while getopts ":hf:v" opt; do
		case $opt in
		h) usage ;;
		f) input_file="$OPTARG" ;;
		v) verbose=true ;;
		?)
			echo "Opção inválida: -$OPTARG" >&2
			exit 1
			;;
		esac
	done

	# Verificação de argumentos obrigatórios
	if [[ -z "$input_file" ]]; then
		echo -e "${RED}[ERRO] A flag -f é obrigatória.${NC}"
		usage
	fi
}

# 7. FUNÇÃO PRINCIPAL (Main)
main() {
	parse_params "$@"

	echo -e "${GREEN}Iniciando execução...${NC}"

	fazer_algo "$input_file"

	echo -e "${GREEN}Concluído com sucesso!${NC}"
}

# Invoca o main passando todos os argumentos do script
main "$@"
